<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.forestry.dao.CertDao">
    <insert id="addWoodCert">
        insert wood_cert (amount, noticePic, ladingPic, declarationPic, cid)
        select #{woodCert.amount}, #{woodCert.noticePic}, #{woodCert.ladingPic}, #{woodCert.declarationPic}, cid
        from company_user_c where uid = #{userId};
    </insert>

    <insert id="addBoardCert">
        insert board_cert (amount, noticePic, declarationPic, contractPic, cid)
        select #{boardCert.amount}, #{boardCert.noticePic}, #{boardCert.declarationPic}, #{boardCert.contractPic}, cid
        from company_user_c where uid = #{userId};
    </insert>

    <select id="getBoardCertAmount" resultType="java.lang.Integer">
        select coalesce(sum(amount), 0) from (select sum(amount) as amount from board_cert where cid = (select cid from company_user_c where uid = #{uid}) and status = 2 group by cid) as a;
    </select>

    <select id="getWoodCertAmount" resultType="java.lang.Integer">
        select coalesce(sum(amount), 0) from (select sum(amount) as amount from wood_cert where cid = (select cid from company_user_c where uid = #{uid}) and status = 2 group by cid) as a;
    </select>

    <select id="getBoardCert" resultType="com.forestry.bean.BoardCert">
        select * from board_cert
        <if test="status != 0">
            where status = #{status}
        </if>
    </select>

    <select id="getWoodCert" resultType="com.forestry.bean.WoodCert">
        select * from wood_cert
        <if test="status != 0">
            where status = #{status}
        </if>
    </select>
</mapper>